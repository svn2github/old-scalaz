<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>scalaz/concurrent/Promise.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scalaz
<span class="keyword">package</span> concurrent

<span class="keyword">import</span> java.util.concurrent.{ConcurrentLinkedQueue, CountDownLatch}
<span class="keyword">import</span> <a href="../Scalaz.scala.html#12368" title="object scalaz.Scalaz">Scalaz</a>._

<span class="keyword">sealed</span> <span class="keyword">trait</span> <a title="trait Promise[A] extends java.lang.Object with ScalaObject" id="13451">Promise</a>[<a title="&gt;: Nothing &lt;: Any" id="17084">A</a>] <span title="ScalaObject">{</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.concurrent.CountDownLatch" id="38391">latch</a> = <span title="java.util.concurrent.CountDownLatch" class="keyword">new</span> <a title="java.util.concurrent.CountDownLatch" id="20374">CountDownLatch</a>(<span title="Int(1)" class="int">1</span>)
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]" id="38393">waiting</a> = <span title="java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]" class="keyword">new</span> <a title="java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]" id="20656">ConcurrentLinkedQueue</a>[A =&gt; Unit]
  @volatile <span class="keyword">private</span> <span class="keyword">var</span> <a title="Option[A]" id="38396">v</a>: <a title="Option[A]" id="276">Option</a>[A] = <a title="object None" id="1078">None</a>
  <span class="keyword">protected</span> <span class="keyword">val</span> <a title="=&gt; scalaz.concurrent.Actor[(Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])]" id="38398">e</a>: <a href="Actor.scala.html#13394" title="scalaz.concurrent.Actor[(Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])]">Actor</a>[(Either[() =&gt; A, A =&gt; Unit], Promise[A])]
  <span class="keyword">val</span> <a title="=&gt; scalaz.concurrent.Strategy[Unit]" id="38399">strategy</a>: <a href="Strategy.scala.html#13466" title="scalaz.concurrent.Strategy[Unit]">Strategy</a>[Unit]

  <span class="keyword">def</span> <a title="=&gt; A" id="38400">get</a> = {
    <a href="#38391" title="=&gt; java.util.concurrent.CountDownLatch">latch</a>.<a title="()Unit" id="41874">await</a>
    <a href="#38396" title="=&gt; Option[A]">v</a>.<span title="=&gt; A">get</span>
  }

  <span class="keyword">def</span> <a title="(a: (A) =&gt; Unit)() =&gt; Unit" id="38401">to</a>(<a title="(A) =&gt; Unit" id="42418">a</a>: A =&gt; Unit) = <a href="Actor.scala.html#23858" title="(a: (Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A]))() =&gt; Unit">e</a> ! (<span title="(_1: Right[Nothing,(A) =&gt; Unit],_2: scalaz.concurrent.Promise[A])(Right[Nothing,(A) =&gt; Unit], scalaz.concurrent.Promise[A])">(</span><a title="(b: (A) =&gt; Unit)Right[Nothing,(A) =&gt; Unit]" id="916">Right</a>(<a href="#42418" title="(A) =&gt; Unit">a</a>), <a href="#13451" title="scalaz.concurrent.Promise[A]" class="keyword">this</a>))

  <span class="keyword">def</span> <a title="[B](f: (A) =&gt; scalaz.concurrent.Promise[B])java.lang.Object with scalaz.concurrent.Promise[B]" id="38402">bind</a>[<a title="&gt;: Nothing &lt;: Any" id="38404">B</a>](<a title="(A) =&gt; scalaz.concurrent.Promise[B]" id="42187">f</a>: A =&gt; Promise[B]) = {
    <span class="keyword">val</span> <a title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[B]" id="42190">r</a> = <a href="#13452" title="object scalaz.concurrent.Promise">Promise</a>.<a href="#41754" title="[A](implicit s: scalaz.concurrent.Strategy[Unit])java.lang.Object with scalaz.concurrent.Promise[A]">mkPromise</a><span title="(implicit s: scalaz.concurrent.Strategy[Unit])java.lang.Object with scalaz.concurrent.Promise[B]">[</span><a href="#38404" title="B">B</a>](<a href="#38399" title="=&gt; scalaz.concurrent.Strategy[Unit]">strategy</a>)
    <span class="keyword">val</span> <a title="scalaz.concurrent.Effect[B]" id="42191">ab</a> = <a href="Effect.scala.html#23958" title="[A](c: (A) =&gt; Unit)(implicit s: scalaz.concurrent.Strategy[Unit])scalaz.concurrent.Effect[A]">effect</a><span title="(c: (B) =&gt; Unit)(implicit s: scalaz.concurrent.Strategy[Unit])scalaz.concurrent.Effect[B]">[</span><a href="#38404" title="B">B</a>]((b: <a href="#38404" title="B">B</a>) =&gt; <a href="#42190" title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[B]">r</a>.<a href="Actor.scala.html#23858" title="(a: (Either[() =&gt; B,(B) =&gt; Unit], scalaz.concurrent.Promise[B]))() =&gt; Unit">e</a> <span title="Unit">!</span> (<span title="(_1: Left[() =&gt; B,Nothing],_2: java.lang.Object with scalaz.concurrent.Promise[B])(Left[() =&gt; B,Nothing], java.lang.Object with scalaz.concurrent.Promise[B])">(</span><span title="(a: () =&gt; B)Left[() =&gt; B,Nothing]">Left</span>(() =&gt; <a href="#42400" title="B">b</a>), <a href="#42190" title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[B]">r</a>)))(<a href="#38399" title="=&gt; scalaz.concurrent.Strategy[Unit]">strategy</a>)
    <a href="#38401" title="(a: (A) =&gt; Unit)() =&gt; Unit">to</a>(<a title="A" id="42436">a</a> =&gt; <a href="#42187" title="(v1: A)scalaz.concurrent.Promise[B]">f</a>(<a href="#42436" title="A">a</a>).<a href="#38401" title="(a: (B) =&gt; Unit)() =&gt; Unit">to</a><span title="Unit">(</span><a href="Effect.scala.html#42441" title="(e: scalaz.concurrent.Effect[B])(B) =&gt; Unit">ab</a>))
    <a href="#42190" title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[B]">r</a>
  }

  <span class="keyword">def</span> <a title="=&gt; A" id="38405">apply</a> = <a href="#38400" title="=&gt; A">get</a>
}

<span class="keyword">trait</span> <a title="trait Promises extends java.lang.Object with ScalaObject" id="13454">Promises</a> <span title="ScalaObject">{</span>
  <span class="keyword">def</span> <a title="[A](a: =&gt; A)(implicit s: scalaz.concurrent.Strategy[Unit])scalaz.concurrent.Promise[A]" id="24202">promise</a>[<a title="&gt;: Nothing &lt;: Any" id="24204">A</a>](<a title="=&gt; A" id="144396">a</a>: =&gt; A)(<span class="keyword">implicit</span> <a title="scalaz.concurrent.Strategy[Unit]" id="144397">s</a>: <a href="Strategy.scala.html#13466" title="scalaz.concurrent.Strategy[Unit]">Strategy</a>[Unit]): <a href="#13451" title="scalaz.concurrent.Promise[A]">Promise</a>[A] = <a href="#13452" title="object scalaz.concurrent.Promise">Promise</a>.<a href="#41757" title="(a: =&gt; A)(implicit s: scalaz.concurrent.Strategy[Unit])scalaz.concurrent.Promise[A]">promise</a><a href="#144397" title="scalaz.concurrent.Strategy[Unit]">(</a><a href="#144396" title="=&gt; A">a</a>) 
}

<span class="keyword">object</span> <a title="object scalaz.concurrent.Promise" id="13452">Promise</a> <span title="ScalaObject">{</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="[A](implicit s: scalaz.concurrent.Strategy[Unit])java.lang.Object with scalaz.concurrent.Promise[A]" id="41754">mkPromise</a>[<a title="&gt;: Nothing &lt;: Any" id="41756">A</a>](<span class="keyword">implicit</span> <a title="scalaz.concurrent.Strategy[Unit]" id="42192">s</a>: <a href="Strategy.scala.html#13466" title="scalaz.concurrent.Strategy[Unit]">Strategy</a>[Unit]) = <a href="#42195" title="java.lang.Object with scalaz.concurrent.Promise[A]{}" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scalaz.concurrent.Promise[A]" id="42195">Promise</a>[A] {
    <span class="keyword">val</span> <a title="scalaz.concurrent.Strategy[Unit]" id="42197">strategy</a> = <a href="#42192" title="scalaz.concurrent.Strategy[Unit]">s</a>
    <span class="keyword">val</span> <a title="scalaz.concurrent.Actor[(Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])]" id="42199">e</a> = <a href="Actor.scala.html#23877" title="(c: ((Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])) =&gt; Unit)(implicit s: scalaz.concurrent.Strategy[Unit])scalaz.concurrent.Actor[(Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])]">actor</a><a href="#42192" title="scalaz.concurrent.Strategy[Unit]">(</a>(p: <a title="(Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])" id="855">(</a>Either[() =&gt; A, A =&gt; Unit], Promise[A])) =&gt; {
      <span class="keyword">val</span> <a title="scalaz.concurrent.Promise[A]" id="42212">promise</a> = <a href="#42211" title="(Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])">p</a>.<a title="=&gt; scalaz.concurrent.Promise[A]" id="25849">_2</a>
      <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]" id="42213">as</a> = <a href="#42212" title="scalaz.concurrent.Promise[A]">promise</a>.<a href="#38393" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]">waiting</a>
      <a href="#42211" title="(Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])">p</a>.<a title="=&gt; Either[() =&gt; A,(A) =&gt; Unit]" id="25847">_1</a> <span title="Unit" class="keyword">match</span> {
        <span title="Unit" class="keyword">case</span> Left(<a title="() =&gt; A" id="42317">l</a>) =&gt; {
          <span class="keyword">val</span> <a title="A" id="42319">a</a> = <a href="#42317" title="()A" id="22297">l</a>()
          <a href="#42212" title="scalaz.concurrent.Promise[A]">promise</a>.<a href="#38396" title="(x$1: Option[A])Unit">v</a> = <a title="(x: A)Some[A]" id="1429">Some</a>(<a href="#42319" title="A">a</a>)
          <a href="#42212" title="scalaz.concurrent.Promise[A]">promise</a>.<a href="#38391" title="=&gt; java.util.concurrent.CountDownLatch">latch</a>.<a title="()Unit" id="41878">countDown</a>
          <span title="Unit" class="keyword">while</span> (<a title="=&gt; Boolean" id="3652">!</a><a href="#42213" title="java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]">as</a>.<a title="()Boolean" id="24351">isEmpty</a>) (<a href="#42213" title="java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]">as</a>.<a title="()(A) =&gt; Unit" id="24371">remove</a><span title="(v1: A)Unit">(</span>))<a href="#42329" title="()Unit">(</a><a href="#42319" title="A">a</a>)
        }
        <span title="Unit" class="keyword">case</span> Right(<a title="(A) =&gt; Unit" id="42373">r</a>) =&gt; {
          <span title="Unit" class="keyword">if</span> (<a href="#42212" title="scalaz.concurrent.Promise[A]">promise</a>.<a href="#38396" title="=&gt; Option[A]">v</a>.<a title="=&gt; Boolean" id="27453">isEmpty</a>) <a href="#42213" title="java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]">as</a>.<a title="(x$1: (A) =&gt; Unit)Boolean" id="24345">offer</a><span title="Unit">(</span><a href="#42373" title="(A) =&gt; Unit">r</a>)
          <span class="keyword">else</span> <a href="#42373" title="(v1: A)Unit">r</a>(<a href="#42212" title="scalaz.concurrent.Promise[A]">promise</a>.<a href="#38396" title="=&gt; Option[A]">v</a>.<span title="=&gt; A">get</span>)
        }
      }
    })
  }

  <span class="keyword">def</span> <a title="[A](a: =&gt; A)(implicit s: scalaz.concurrent.Strategy[Unit])scalaz.concurrent.Promise[A]" id="41757">promise</a>[<a title="&gt;: Nothing &lt;: Any" id="41759">A</a>](<a title="=&gt; A" id="225811">a</a>: =&gt; A)(<span class="keyword">implicit</span> <a title="scalaz.concurrent.Strategy[Unit]" id="225812">s</a>: <a href="Strategy.scala.html#13466" title="scalaz.concurrent.Strategy[Unit]">Strategy</a>[Unit]): <a href="#13451" title="scalaz.concurrent.Promise[A]">Promise</a>[A] = {
    <span class="keyword">val</span> <a title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[A]" id="225824">p</a> = <a href="#41754" title="[A](implicit s: scalaz.concurrent.Strategy[Unit])java.lang.Object with scalaz.concurrent.Promise[A]">mkPromise</a><a href="#225812" title="(implicit s: scalaz.concurrent.Strategy[Unit])java.lang.Object with scalaz.concurrent.Promise[A]">[</a><a href="#41759" title="A">A</a>]
    <a href="#225824" title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[A]">p</a>.<a href="Actor.scala.html#23858" title="(a: (Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A]))() =&gt; Unit">e</a> ! (<span title="(_1: Left[() =&gt; A,Nothing],_2: java.lang.Object with scalaz.concurrent.Promise[A])(Left[() =&gt; A,Nothing], java.lang.Object with scalaz.concurrent.Promise[A])">(</span><span title="(a: () =&gt; A)Left[() =&gt; A,Nothing]">Left</span>(() =&gt; <a href="#225811" title="=&gt; A">a</a>), <a href="#225824" title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[A]">p</a>))
    <a href="#225824" title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[A]">p</a>
  }

  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="[A](implicit a: scalaz.concurrent.Promise[A])() =&gt; A" id="41760">PromiseFrom</a>[<a title="&gt;: Nothing &lt;: Any" id="41762">A</a>](<span class="keyword">implicit</span> <a title="scalaz.concurrent.Promise[A]" id="41862">a</a>: <a href="#13451" title="scalaz.concurrent.Promise[A]">Promise</a>[A]) = () =&gt; <a href="#41862" title="scalaz.concurrent.Promise[A]">a</a>.<a href="#38400" title="=&gt; A">get</a>  
}

        </pre>
    </body>
</html>
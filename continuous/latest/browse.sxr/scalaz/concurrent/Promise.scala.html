<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>scalaz/concurrent/Promise.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scalaz
<span class="keyword">package</span> concurrent

<span class="keyword">import</span> java.util.concurrent.{ConcurrentLinkedQueue, CountDownLatch}
<span class="keyword">import</span> <a href="../Scalaz.scala.html#12688" title="object scalaz.Scalaz">Scalaz</a>._

<span class="keyword">sealed</span> <span class="keyword">trait</span> <a title="trait Promise[A] extends java.lang.Object with ScalaObject" id="13693">Promise</a>[<a title="&gt;: Nothing &lt;: Any" id="17389">A</a>] <span title="ScalaObject">{</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.concurrent.CountDownLatch" id="33482">latch</a> = <span title="java.util.concurrent.CountDownLatch" class="keyword">new</span> <a title="java.util.concurrent.CountDownLatch" id="20693">CountDownLatch</a>(<span title="Int(1)" class="int">1</span>)
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]" id="33484">waiting</a> = <span title="java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]" class="keyword">new</span> <a title="java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]" id="20975">ConcurrentLinkedQueue</a>[A =&gt; Unit]
  @volatile <span class="keyword">private</span> <span class="keyword">var</span> <a title="Option[A]" id="33487">v</a>: <a title="Option[A]" id="1262">Option</a>[A] = <a title="object None" id="1839">None</a>
  <span class="keyword">protected</span> <span class="keyword">val</span> <a title="=&gt; scalaz.concurrent.Actor[(Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])]" id="33489">e</a>: <a href="Actor.scala.html#13636" title="scalaz.concurrent.Actor[(Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])]">Actor</a>[(Either[() =&gt; A, A =&gt; Unit], Promise[A])]
  <span class="keyword">val</span> <a title="=&gt; scalaz.concurrent.Strategy[Unit]" id="33490">strategy</a>: <a href="Strategy.scala.html#13708" title="scalaz.concurrent.Strategy[Unit]">Strategy</a>[Unit]

  <span class="keyword">def</span> <a title="=&gt; A" id="33491">get</a> = {
    <a href="#33482" title="=&gt; java.util.concurrent.CountDownLatch">latch</a>.<a title="()Unit" id="38682">await</a>
    <a href="#33487" title="=&gt; Option[A]">v</a>.<span title="=&gt; A">get</span>
  }

  <span class="keyword">def</span> <a title="(a: (A) =&gt; Unit)() =&gt; Unit" id="33492">to</a>(<a title="(A) =&gt; Unit" id="82275">a</a>: A =&gt; Unit) = <a href="Actor.scala.html#24192" title="(a: (Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A]))() =&gt; Unit">e</a> ! (<span title="(_1: Right[Nothing,(A) =&gt; Unit],_2: scalaz.concurrent.Promise[A])(Right[Nothing,(A) =&gt; Unit], scalaz.concurrent.Promise[A])">(</span><a title="(b: (A) =&gt; Unit)Right[Nothing,(A) =&gt; Unit]" id="684">Right</a>(<a href="#82275" title="(A) =&gt; Unit">a</a>), <a href="#13693" title="scalaz.concurrent.Promise[A]" class="keyword">this</a>))

  <span class="keyword">def</span> <a title="[B](f: (A) =&gt; scalaz.concurrent.Promise[B])java.lang.Object with scalaz.concurrent.Promise[B]" id="33493">bind</a>[<a title="&gt;: Nothing &lt;: Any" id="33495">B</a>](<a title="(A) =&gt; scalaz.concurrent.Promise[B]" id="82112">f</a>: A =&gt; Promise[B]) = {
    <span class="keyword">val</span> <a title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[B]" id="82115">r</a> = <a href="#13694" title="object scalaz.concurrent.Promise">Promise</a>.<a href="#38449" title="[A](implicit s: scalaz.concurrent.Strategy[Unit])java.lang.Object with scalaz.concurrent.Promise[A]">mkPromise</a><span title="(implicit s: scalaz.concurrent.Strategy[Unit])java.lang.Object with scalaz.concurrent.Promise[B]">[</span><a href="#33495" title="B">B</a>](<a href="#33490" title="=&gt; scalaz.concurrent.Strategy[Unit]">strategy</a>)
    <span class="keyword">val</span> <a title="scalaz.concurrent.Effect[B]" id="82116">ab</a> = <a href="Effect.scala.html#24292" title="[A](c: (A) =&gt; Unit)(implicit s: scalaz.concurrent.Strategy[Unit])scalaz.concurrent.Effect[A]">effect</a><span title="(c: (B) =&gt; Unit)(implicit s: scalaz.concurrent.Strategy[Unit])scalaz.concurrent.Effect[B]">[</span><a href="#33495" title="B">B</a>]((b: <a href="#33495" title="B">B</a>) =&gt; <a href="#82115" title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[B]">r</a>.<a href="Actor.scala.html#24192" title="(a: (Either[() =&gt; B,(B) =&gt; Unit], scalaz.concurrent.Promise[B]))() =&gt; Unit">e</a> <span title="Unit">!</span> (<span title="(_1: Left[() =&gt; B,Nothing],_2: java.lang.Object with scalaz.concurrent.Promise[B])(Left[() =&gt; B,Nothing], java.lang.Object with scalaz.concurrent.Promise[B])">(</span><span title="(a: () =&gt; B)Left[() =&gt; B,Nothing]">Left</span>(() =&gt; <a href="#82257" title="B">b</a>), <a href="#82115" title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[B]">r</a>)))(<a href="#33490" title="=&gt; scalaz.concurrent.Strategy[Unit]">strategy</a>)
    <a href="#33492" title="(a: (A) =&gt; Unit)() =&gt; Unit">to</a>(<a title="A" id="82293">a</a> =&gt; <a href="#82112" title="(v1: A)scalaz.concurrent.Promise[B]">f</a>(<a href="#82293" title="A">a</a>).<a href="#33492" title="(a: (B) =&gt; Unit)() =&gt; Unit">to</a><span title="Unit">(</span><a href="Effect.scala.html#82298" title="(e: scalaz.concurrent.Effect[B])(B) =&gt; Unit">ab</a>))
    <a href="#82115" title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[B]">r</a>
  }

  <span class="keyword">def</span> <a title="=&gt; A" id="33496">apply</a> = <a href="#33491" title="=&gt; A">get</a>
}

<span class="keyword">trait</span> <a title="trait Promises extends java.lang.Object with ScalaObject" id="13696">Promises</a> <span title="ScalaObject">{</span>
  <span class="keyword">def</span> <a title="[A](a: =&gt; A)(implicit s: scalaz.concurrent.Strategy[Unit])scalaz.concurrent.Promise[A]" id="24536">promise</a>[<a title="&gt;: Nothing &lt;: Any" id="24538">A</a>](<a title="=&gt; A" id="142134">a</a>: =&gt; A)(<span class="keyword">implicit</span> <a title="scalaz.concurrent.Strategy[Unit]" id="142135">s</a>: <a href="Strategy.scala.html#13708" title="scalaz.concurrent.Strategy[Unit]">Strategy</a>[Unit]): <a href="#13693" title="scalaz.concurrent.Promise[A]">Promise</a>[A] = <a href="#13694" title="object scalaz.concurrent.Promise">Promise</a>.<a href="#38452" title="(a: =&gt; A)(implicit s: scalaz.concurrent.Strategy[Unit])scalaz.concurrent.Promise[A]">promise</a><a href="#142135" title="scalaz.concurrent.Strategy[Unit]">(</a><a href="#142134" title="=&gt; A">a</a>) 
}

<span class="keyword">object</span> <a title="object scalaz.concurrent.Promise" id="13694">Promise</a> <span title="ScalaObject">{</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="[A](implicit s: scalaz.concurrent.Strategy[Unit])java.lang.Object with scalaz.concurrent.Promise[A]" id="38449">mkPromise</a>[<a title="&gt;: Nothing &lt;: Any" id="38451">A</a>](<span class="keyword">implicit</span> <a title="scalaz.concurrent.Strategy[Unit]" id="82117">s</a>: <a href="Strategy.scala.html#13708" title="scalaz.concurrent.Strategy[Unit]">Strategy</a>[Unit]) = <a href="#82120" title="java.lang.Object with scalaz.concurrent.Promise[A]{}" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scalaz.concurrent.Promise[A]" id="82120">Promise</a>[A] {
    <span class="keyword">val</span> <a title="scalaz.concurrent.Strategy[Unit]" id="82122">strategy</a> = <a href="#82117" title="scalaz.concurrent.Strategy[Unit]">s</a>
    <span class="keyword">val</span> <a title="scalaz.concurrent.Actor[(Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])]" id="82124">e</a> = <a href="Actor.scala.html#24211" title="(c: ((Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])) =&gt; Unit)(implicit s: scalaz.concurrent.Strategy[Unit])scalaz.concurrent.Actor[(Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])]">actor</a><a href="#82117" title="scalaz.concurrent.Strategy[Unit]">(</a>(p: <a title="(Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])" id="632">(</a>Either[() =&gt; A, A =&gt; Unit], Promise[A])) =&gt; {
      <span class="keyword">val</span> <a title="scalaz.concurrent.Promise[A]" id="82137">promise</a> = <a href="#82136" title="(Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])">p</a>.<a title="=&gt; scalaz.concurrent.Promise[A]" id="26699">_2</a>
      <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]" id="82138">as</a> = <a href="#82137" title="scalaz.concurrent.Promise[A]">promise</a>.<a href="#33484" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]">waiting</a>
      <a href="#82136" title="(Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])">p</a>.<a title="=&gt; Either[() =&gt; A,(A) =&gt; Unit]" id="26697">_1</a> <span title="Unit" class="keyword">match</span> {
        <span title="Unit" class="keyword">case</span> Left(<a title="() =&gt; A" id="82208">l</a>) =&gt; {
          <span class="keyword">val</span> <a title="A" id="82210">a</a> = <a href="#82208" title="()A" id="22619">l</a>()
          <a href="#82137" title="scalaz.concurrent.Promise[A]">promise</a>.<a href="#33487" title="(x$1: Option[A])Unit">v</a> = <a title="(x: A)Some[A]" id="1005">Some</a>(<a href="#82210" title="A">a</a>)
          <a href="#82137" title="scalaz.concurrent.Promise[A]">promise</a>.<a href="#33482" title="=&gt; java.util.concurrent.CountDownLatch">latch</a>.<a title="()Unit" id="38686">countDown</a>
          <span title="Unit" class="keyword">while</span> (<a title="=&gt; Boolean" id="4329">!</a><a href="#82138" title="java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]">as</a>.<a title="()Boolean" id="24731">isEmpty</a>) (<a href="#82138" title="java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]">as</a>.<a title="()(A) =&gt; Unit" id="25193">remove</a><span title="(v1: A)Unit">(</span>))<a href="#82220" title="()Unit">(</a><a href="#82210" title="A">a</a>)
        }
        <span title="Unit" class="keyword">case</span> Right(<a title="(A) =&gt; Unit" id="82230">r</a>) =&gt; {
          <span title="Unit" class="keyword">if</span> (<a href="#82137" title="scalaz.concurrent.Promise[A]">promise</a>.<a href="#33487" title="=&gt; Option[A]">v</a>.<a title="=&gt; Boolean" id="28283">isEmpty</a>) <a href="#82138" title="java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]">as</a>.<a title="(x$1: (A) =&gt; Unit)Boolean" id="24725">offer</a><span title="Unit">(</span><a href="#82230" title="(A) =&gt; Unit">r</a>)
          <span class="keyword">else</span> <a href="#82230" title="(v1: A)Unit">r</a>(<a href="#82137" title="scalaz.concurrent.Promise[A]">promise</a>.<a href="#33487" title="=&gt; Option[A]">v</a>.<span title="=&gt; A">get</span>)
        }
      }
    })
  }

  <span class="keyword">def</span> <a title="[A](a: =&gt; A)(implicit s: scalaz.concurrent.Strategy[Unit])scalaz.concurrent.Promise[A]" id="38452">promise</a>[<a title="&gt;: Nothing &lt;: Any" id="38454">A</a>](<a title="=&gt; A" id="228187">a</a>: =&gt; A)(<span class="keyword">implicit</span> <a title="scalaz.concurrent.Strategy[Unit]" id="228188">s</a>: <a href="Strategy.scala.html#13708" title="scalaz.concurrent.Strategy[Unit]">Strategy</a>[Unit]): <a href="#13693" title="scalaz.concurrent.Promise[A]">Promise</a>[A] = {
    <span class="keyword">val</span> <a title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[A]" id="228200">p</a> = <a href="#38449" title="[A](implicit s: scalaz.concurrent.Strategy[Unit])java.lang.Object with scalaz.concurrent.Promise[A]">mkPromise</a><a href="#228188" title="(implicit s: scalaz.concurrent.Strategy[Unit])java.lang.Object with scalaz.concurrent.Promise[A]">[</a><a href="#38454" title="A">A</a>]
    <a href="#228200" title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[A]">p</a>.<a href="Actor.scala.html#24192" title="(a: (Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A]))() =&gt; Unit">e</a> ! (<span title="(_1: Left[() =&gt; A,Nothing],_2: java.lang.Object with scalaz.concurrent.Promise[A])(Left[() =&gt; A,Nothing], java.lang.Object with scalaz.concurrent.Promise[A])">(</span><span title="(a: () =&gt; A)Left[() =&gt; A,Nothing]">Left</span>(() =&gt; <a href="#228187" title="=&gt; A">a</a>), <a href="#228200" title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[A]">p</a>))
    <a href="#228200" title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[A]">p</a>
  }

  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="[A](implicit a: scalaz.concurrent.Promise[A])() =&gt; A" id="38455">PromiseFrom</a>[<a title="&gt;: Nothing &lt;: Any" id="38457">A</a>](<span class="keyword">implicit</span> <a title="scalaz.concurrent.Promise[A]" id="38670">a</a>: <a href="#13693" title="scalaz.concurrent.Promise[A]">Promise</a>[A]) = () =&gt; <a href="#38670" title="scalaz.concurrent.Promise[A]">a</a>.<a href="#33491" title="=&gt; A">get</a>  
}

        </pre>
    </body>
</html>
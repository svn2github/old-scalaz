<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>scalaz/concurrent/Promise.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scalaz
<span class="keyword">package</span> concurrent

<span class="keyword">import</span> java.util.concurrent.{ConcurrentLinkedQueue, CountDownLatch}
<span class="keyword">import</span> <a href="../Scalaz.scala.html#11737" title="object scalaz.Scalaz">Scalaz</a>._

<span class="keyword">sealed</span> <span class="keyword">trait</span> <a title="trait Promise[A] extends java.lang.Object with ScalaObject" id="12723">Promise</a>[<a title="&gt;: Nothing &lt;: Any" id="16093">A</a>] <span title="ScalaObject">{</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.concurrent.CountDownLatch" id="30741">latch</a> = <span title="java.util.concurrent.CountDownLatch" class="keyword">new</span> <a title="java.util.concurrent.CountDownLatch" id="19286">CountDownLatch</a>(<span title="Int(1)" class="int">1</span>)
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]" id="30743">waiting</a> = <span title="java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]" class="keyword">new</span> <a title="java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]" id="19568">ConcurrentLinkedQueue</a>[A =&gt; Unit]
  @volatile <span class="keyword">private</span> <span class="keyword">var</span> <a title="Option[A]" id="30746">v</a>: <a title="Option[A]" id="220">Option</a>[A] = <a title="object None" id="866">None</a>
  <span class="keyword">protected</span> <span class="keyword">val</span> <a title="=&gt; scalaz.concurrent.Actor[(Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])]" id="30748">e</a>: <a href="Actor.scala.html#12666" title="scalaz.concurrent.Actor[(Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])]">Actor</a>[(Either[() =&gt; A, A =&gt; Unit], Promise[A])]
  <span class="keyword">val</span> <a title="=&gt; scalaz.concurrent.Strategy[Unit]" id="30749">strategy</a>: <a href="Strategy.scala.html#12738" title="scalaz.concurrent.Strategy[Unit]">Strategy</a>[Unit]

  <span class="keyword">def</span> <a title="=&gt; A" id="30750">get</a> = {
    <a href="#30741" title="=&gt; java.util.concurrent.CountDownLatch">latch</a>.<a title="()Unit" id="36056">await</a>
    <a href="#30746" title="=&gt; Option[A]">v</a>.<span title="=&gt; A">get</span>
  }

  <span class="keyword">def</span> <a title="(a: (A) =&gt; Unit)() =&gt; Unit" id="30751">to</a>(<a title="(A) =&gt; Unit" id="36518">a</a>: A =&gt; Unit) = <a href="Actor.scala.html#23008" title="(a: (Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A]))() =&gt; Unit">e</a> ! (<span title="(_1: Right[Nothing,(A) =&gt; Unit],_2: scalaz.concurrent.Promise[A])(Right[Nothing,(A) =&gt; Unit], scalaz.concurrent.Promise[A])">(</span><a title="(b: (A) =&gt; Unit)Right[Nothing,(A) =&gt; Unit]" id="746">Right</a>(<a href="#36518" title="(A) =&gt; Unit">a</a>), <a href="#12723" title="scalaz.concurrent.Promise[A]" class="keyword">this</a>))

  <span class="keyword">def</span> <a title="[B](f: (A) =&gt; scalaz.concurrent.Promise[B])java.lang.Object with scalaz.concurrent.Promise[B]" id="30752">bind</a>[<a title="&gt;: Nothing &lt;: Any" id="30754">B</a>](<a title="(A) =&gt; scalaz.concurrent.Promise[B]" id="36291">f</a>: A =&gt; Promise[B]) = {
    <span class="keyword">val</span> <a title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[B]" id="36294">r</a> = <a href="#12724" title="object scalaz.concurrent.Promise">Promise</a>.<a href="#35967" title="[A](implicit s: scalaz.concurrent.Strategy[Unit])java.lang.Object with scalaz.concurrent.Promise[A]">mkPromise</a><span title="(implicit s: scalaz.concurrent.Strategy[Unit])java.lang.Object with scalaz.concurrent.Promise[B]">[</span><a href="#30754" title="B">B</a>](<a href="#30749" title="=&gt; scalaz.concurrent.Strategy[Unit]">strategy</a>)
    <span class="keyword">val</span> <a title="scalaz.concurrent.Effect[B]" id="36295">ab</a> = <a href="Effect.scala.html#23123" title="[A](c: (A) =&gt; Unit)(implicit s: scalaz.concurrent.Strategy[Unit])scalaz.concurrent.Effect[A]">effect</a><span title="(c: (B) =&gt; Unit)(implicit s: scalaz.concurrent.Strategy[Unit])scalaz.concurrent.Effect[B]">[</span><a href="#30754" title="B">B</a>]((b: <a href="#30754" title="B">B</a>) =&gt; <a href="#36294" title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[B]">r</a>.<a href="Actor.scala.html#23008" title="(a: (Either[() =&gt; B,(B) =&gt; Unit], scalaz.concurrent.Promise[B]))() =&gt; Unit">e</a> <span title="Unit">!</span> (<span title="(_1: Left[() =&gt; B,Nothing],_2: java.lang.Object with scalaz.concurrent.Promise[B])(Left[() =&gt; B,Nothing], java.lang.Object with scalaz.concurrent.Promise[B])">(</span><span title="(a: () =&gt; B)Left[() =&gt; B,Nothing]">Left</span>(() =&gt; <a href="#36500" title="B">b</a>), <a href="#36294" title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[B]">r</a>)))(<a href="#30749" title="=&gt; scalaz.concurrent.Strategy[Unit]">strategy</a>)
    <a href="#30751" title="(a: (A) =&gt; Unit)() =&gt; Unit">to</a>(<a title="A" id="36536">a</a> =&gt; <a href="#36291" title="(v1: A)scalaz.concurrent.Promise[B]">f</a>(<a href="#36536" title="A">a</a>).<a href="#30751" title="(a: (B) =&gt; Unit)() =&gt; Unit">to</a><span title="Unit">(</span><a href="Effect.scala.html#36541" title="(e: scalaz.concurrent.Effect[B])(B) =&gt; Unit">ab</a>))
    <a href="#36294" title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[B]">r</a>
  }

  <span class="keyword">def</span> <a title="=&gt; A" id="30755">apply</a> = <a href="#30750" title="=&gt; A">get</a>
}

<span class="keyword">trait</span> <a title="trait Promises extends java.lang.Object with ScalaObject" id="12726">Promises</a> <span title="ScalaObject">{</span>
  <span class="keyword">def</span> <a title="[A](a: =&gt; A)(implicit s: scalaz.concurrent.Strategy[Unit])scalaz.concurrent.Promise[A]" id="23381">promise</a>[<a title="&gt;: Nothing &lt;: Any" id="23383">A</a>](<a title="=&gt; A" id="125045">a</a>: =&gt; A)(<span class="keyword">implicit</span> <a title="scalaz.concurrent.Strategy[Unit]" id="125046">s</a>: <a href="Strategy.scala.html#12738" title="scalaz.concurrent.Strategy[Unit]">Strategy</a>[Unit]): <a href="#12723" title="scalaz.concurrent.Promise[A]">Promise</a>[A] = <a href="#12724" title="object scalaz.concurrent.Promise">Promise</a>.<a href="#35970" title="(a: =&gt; A)(implicit s: scalaz.concurrent.Strategy[Unit])scalaz.concurrent.Promise[A]">promise</a><a href="#125046" title="scalaz.concurrent.Strategy[Unit]">(</a><a href="#125045" title="=&gt; A">a</a>) 
}

<span class="keyword">object</span> <a title="object scalaz.concurrent.Promise" id="12724">Promise</a> <span title="ScalaObject">{</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="[A](implicit s: scalaz.concurrent.Strategy[Unit])java.lang.Object with scalaz.concurrent.Promise[A]" id="35967">mkPromise</a>[<a title="&gt;: Nothing &lt;: Any" id="35969">A</a>](<span class="keyword">implicit</span> <a title="scalaz.concurrent.Strategy[Unit]" id="36296">s</a>: <a href="Strategy.scala.html#12738" title="scalaz.concurrent.Strategy[Unit]">Strategy</a>[Unit]) = <a href="#36299" title="java.lang.Object with scalaz.concurrent.Promise[A]{}" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scalaz.concurrent.Promise[A]" id="36299">Promise</a>[A] {
    <span class="keyword">val</span> <a title="scalaz.concurrent.Strategy[Unit]" id="36301">strategy</a> = <a href="#36296" title="scalaz.concurrent.Strategy[Unit]">s</a>
    <span class="keyword">val</span> <a title="scalaz.concurrent.Actor[(Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])]" id="36303">e</a> = <a href="Actor.scala.html#23027" title="(c: ((Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])) =&gt; Unit)(implicit s: scalaz.concurrent.Strategy[Unit])scalaz.concurrent.Actor[(Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])]">actor</a><a href="#36296" title="scalaz.concurrent.Strategy[Unit]">(</a>(p: <a title="(Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])" id="694">(</a>Either[() =&gt; A, A =&gt; Unit], Promise[A])) =&gt; {
      <span class="keyword">val</span> <a title="scalaz.concurrent.Promise[A]" id="36316">promise</a> = <a href="#36315" title="(Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])">p</a>.<a title="=&gt; scalaz.concurrent.Promise[A]" id="24859">_2</a>
      <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]" id="36317">as</a> = <a href="#36316" title="scalaz.concurrent.Promise[A]">promise</a>.<a href="#30743" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]">waiting</a>
      <a href="#36315" title="(Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A])">p</a>.<a title="=&gt; Either[() =&gt; A,(A) =&gt; Unit]" id="24857">_1</a> <span title="Unit" class="keyword">match</span> {
        <span title="Unit" class="keyword">case</span> Left(<a title="() =&gt; A" id="36416">l</a>) =&gt; {
          <span class="keyword">val</span> <a title="A" id="36418">a</a> = <a href="#36416" title="()A" id="21151">l</a>()
          <a href="#36316" title="scalaz.concurrent.Promise[A]">promise</a>.<a href="#30746" title="(x$1: Option[A])Unit">v</a> = <a title="(x: A)Some[A]" id="1124">Some</a>(<a href="#36418" title="A">a</a>)
          <a href="#36316" title="scalaz.concurrent.Promise[A]">promise</a>.<a href="#30741" title="=&gt; java.util.concurrent.CountDownLatch">latch</a>.<a title="()Unit" id="36060">countDown</a>
          <span title="Unit" class="keyword">while</span> (<a title="=&gt; Boolean" id="2599">!</a><a href="#36317" title="java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]">as</a>.<a title="()Boolean" id="23563">isEmpty</a>) (<a href="#36317" title="java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]">as</a>.<a title="()(A) =&gt; Unit" id="23583">remove</a><span title="(v1: A)Unit">(</span>))<a href="#36428" title="()Unit">(</a><a href="#36418" title="A">a</a>)
        }
        <span title="Unit" class="keyword">case</span> Right(<a title="(A) =&gt; Unit" id="36472">r</a>) =&gt; {
          <span title="Unit" class="keyword">if</span> (<a href="#36316" title="scalaz.concurrent.Promise[A]">promise</a>.<a href="#30746" title="=&gt; Option[A]">v</a>.<a title="=&gt; Boolean" id="26339">isEmpty</a>) <a href="#36317" title="java.util.concurrent.ConcurrentLinkedQueue[(A) =&gt; Unit]">as</a>.<a title="(x$1: (A) =&gt; Unit)Boolean" id="23557">offer</a><span title="Unit">(</span><a href="#36472" title="(A) =&gt; Unit">r</a>)
          <span class="keyword">else</span> <a href="#36472" title="(v1: A)Unit">r</a>(<a href="#36316" title="scalaz.concurrent.Promise[A]">promise</a>.<a href="#30746" title="=&gt; Option[A]">v</a>.<span title="=&gt; A">get</span>)
        }
      }
    })
  }

  <span class="keyword">def</span> <a title="[A](a: =&gt; A)(implicit s: scalaz.concurrent.Strategy[Unit])scalaz.concurrent.Promise[A]" id="35970">promise</a>[<a title="&gt;: Nothing &lt;: Any" id="35972">A</a>](<a title="=&gt; A" id="191164">a</a>: =&gt; A)(<span class="keyword">implicit</span> <a title="scalaz.concurrent.Strategy[Unit]" id="191165">s</a>: <a href="Strategy.scala.html#12738" title="scalaz.concurrent.Strategy[Unit]">Strategy</a>[Unit]): <a href="#12723" title="scalaz.concurrent.Promise[A]">Promise</a>[A] = {
    <span class="keyword">val</span> <a title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[A]" id="191178">p</a> = <a href="#35967" title="[A](implicit s: scalaz.concurrent.Strategy[Unit])java.lang.Object with scalaz.concurrent.Promise[A]">mkPromise</a><a href="#191165" title="(implicit s: scalaz.concurrent.Strategy[Unit])java.lang.Object with scalaz.concurrent.Promise[A]">[</a><a href="#35972" title="A">A</a>]
    <a href="#191178" title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[A]">p</a>.<a href="Actor.scala.html#23008" title="(a: (Either[() =&gt; A,(A) =&gt; Unit], scalaz.concurrent.Promise[A]))() =&gt; Unit">e</a> ! (<span title="(_1: Left[() =&gt; A,Nothing],_2: java.lang.Object with scalaz.concurrent.Promise[A])(Left[() =&gt; A,Nothing], java.lang.Object with scalaz.concurrent.Promise[A])">(</span><span title="(a: () =&gt; A)Left[() =&gt; A,Nothing]">Left</span>(() =&gt; <a href="#191164" title="=&gt; A">a</a>), <a href="#191178" title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[A]">p</a>))
    <a href="#191178" title="&lt;refinement&gt; extends java.lang.Object with scalaz.concurrent.Promise[A]">p</a>
  }

  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="[A](implicit a: scalaz.concurrent.Promise[A])() =&gt; A" id="35973">PromiseFrom</a>[<a title="&gt;: Nothing &lt;: Any" id="35975">A</a>](<span class="keyword">implicit</span> <a title="scalaz.concurrent.Promise[A]" id="36044">a</a>: <a href="#12723" title="scalaz.concurrent.Promise[A]">Promise</a>[A]) = () =&gt; <a href="#36044" title="scalaz.concurrent.Promise[A]">a</a>.<a href="#30750" title="=&gt; A">get</a>  
}

        </pre>
    </body>
</html>